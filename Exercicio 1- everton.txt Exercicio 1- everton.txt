
#Verificar pasta do diretório
install.packages("vegan")
library(vegan)
library(ggplot2)

aves <- read.csv("AVES.csv", sep=';', stringsAsFactors = TRUE) #Abrirndo e criando o dataframe
nrow(aves) #para saber número de linhas
ncol(aves) #para saber número de colunas
colnames(aves) #para saber nome das colunas

#vemos que o R está considerando algumas colunas vazias como parte do dataframe. Podemos apagá-las 
#para manejar melhor os dados
aves<- aves[,1:38]

colnames(aves) #vamos olhar novamente o nome das colunas

summary(aves) #Avaliando a natureza da informação contida no objeto criado. Testem abrir o arquivo 
#alternando o último arguento da função entre TRUE e FALSE e vejam a diferença. 

####MANIPULANDO E EXPLORANDO DADOS TEXTUAIS E CATEGÓRICOS####


#Vamos avaliar quantas espécies existem na nossa planilha.
levels(aves$NOME.CIENTIFICO)#Para isso, vamos usar a função levels. Ela nos indica a variabilidade de uma informação 
#categórica, ou seja, os diferentes níveis da informação. 


summary(aves$NOME.CIENTIFICO) #essa função nos mostra quantas vezes cada categoria aparece no dataframe, ou 
#seja, a frequência de cada spp

sort(summary(aves$NOME.CIENTIFICO), decreasing = TRUE) #colocando em ordem para avaliar a distribuicao dos valores

summary(aves$FAMILIA)
sort(summary(aves$FAMILIA), decreasing = FALSE)
summary(aves$SUBFAMILIA)
sort(summary(aves$SUBFAMILIA), decreasing = FALSE)
#avalie quantas famílias e qual a abundância de cada uma no dataframe


#Será que todos esses nomes científicos estão atualmente válidos? Para avaliar isso, vamos usar o pacote rotl que
#é uma interfare para a base de informações do "Open Tree of Life" e oferece diversas funções para 
# manipular dados filogenéticos e taxonômicos.

install.packages("rotl")# pra quem ainda não instalou
library(rotl)


taxa_aves<-tnrs_match_names(aves$NOME.CIENTIFICO, context_name="Birds") #função para checar o nome 
#das spp de acordo com a base do TOF

tnrs_contexts()#para ver todos os contextos taxonômicos que podem ser usados

taxa_aves#vamos olhar o arquivo


taxa_aves[which(taxa_aves$approximate_match==TRUE),]#vamos olhar apenas para as spp que a função encontrou nomes próximos

levels(aves$NOME.CIENTIFICO)# vamos olhar essa info no nosso dataframe

#Assumindo que a plataforma do TOF é confiável pra o grupo taxonômico de interesse, vamos corrigir 
#os nomes científicos no nosso dataframe


aves$NOME.CIENTIFICO<-as.character(aves$NOME.CIENTIFICO) #primeiro precisamos transformar a coluna dos 
#nomes científicos para o tipo "character" e facilitar a manipulação

aves[aves$NOME.CIENTIFICO=="HABIA RUBRA", "NOME.CIENTIFICO"]<- "HABIA RUBIcA" #substituindo o nome
aves[aves$NOME.CIENTIFICO=="XIPHORHYNCHUS GUTTATOIDES", "NOME.CIENTIFICO"]<- "XIPHORHYNCHUS GUTTATUS "
aves$NOME.CIENTIFICO<-as.factor(aves$NOME.CIENTIFICO) #retornando a variável para o tipo factor
levels(aves$NOME.CIENTIFICO) #checando se a alteração foi bem sucedida

#faça o mesmo para a segunda especie indicada como errada

####Exercício 1
#abra a planilha nomeada peixes
install.packages("vegan")
library(vegan)
library(ggplot2)
peixes <- read.csv("peixes.csv", sep=';', stringsAsFactors = TRUE) #Abrirndo e criando o dataframe
nrow(peixes) #para saber número de linhas
ncol(peixes) #para saber número de colunas
colnames(peixes) #para saber nome das colunas
summary(peixes)


#veja quantas familias foram registradas (29 familias)
levels(peixes$FAMILY)

#anote a 5 mais frequentes
summary(peixes$FAMILY)
sort(summary(peixes$FAMILY), decreasing = TRUE)
sort(summary(peixes$FAMILY), decreasing = FALSE)

#Characidae 202
#Cichlidae  200 
#Lebiasinidae 124
#Erythrinidae 97
#Gymnotidae  96

#veja quantas spp foram registradas (147 SPECIES)
levels(peixes$SPECIES)

#anote as 5 mais frequentes
summary(peixes$SPECIES)

test<-sort(summary(peixes$SPECIES), decreasing = TRUE)
sort(summary(peixes$SPECIES), decreasing = FALSE)

#Hyphessobrycon heterorhabdus 60
#Helogenes marmoratus         58
#Erythrinus?erythrinus        57
#Apistogramma gr. regani      53
#Aequidens tetramerus         42
#verifique se os nomes científicos estão de acordo com a plataforma TOF

install.packages("rotl")
library(rotl)


taxa_peixes<-tnrs_match_names(peixes$SPECIES, context_name="Vertebrates")


taxa_peixes


taxa_peixes[which(taxa_peixes$approximate_match==TRUE),]
peixes$SPECIES<-as.character(peixes$SPECIES)



#renomeia as sinonímias
 
peixes[peixes$SPECIES=="Bryconops cf. caudomaculatus", "SPECIES"]<- "Bryconops caudomaculatus "
peixes[peixes$SPECIES=="Crenuchus?spilurus?", "SPECIES"]<- "Crenuchus spilurus"
peixes[peixes$SPECIES=="Astyanax gr. bimaculatus", "SPECIES"]<- "Astyanax bimaculatus "
peixes$SPECIES<-as.factor(peixes$SPECIES)
#reavalie quantas sp existem no dataframe (147 SPECIES)
levels(peixes$SPECIES)